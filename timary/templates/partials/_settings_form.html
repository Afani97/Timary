<form class="card bg-neutral bordered"
    hx-put="{% url 'timary:update_user_settings' %}"
    hx-target="this"
    hx-swap="outerHTML"
    hx-vals='js:{membership_tier: get_membership_tier()}'>
    {% csrf_token %}

    <div class="card-body items-center text-center">
        <h2 class="card-title">Phone number availability</h2>
        <div class="flex justify-center space-x-5 mb-10">
            {% for value, text in form.phone_number_availability.field.choices %}
                <div class="form-control">
                    <label class="label" for="id_phone_number_availability_{{ forloop.counter0 }}"><span class="label-text">{{ text }}</span></label>
                    <input
                        id="id_phone_number_availability_{{ forloop.counter0 }}"
                        name="{{ form.phone_number_availability.name }}"
                        type="checkbox"
                        class="checkbox"
                        value="{{ value }}"
                        {% if value in request.user.settings.phone_number_availability %} checked="checked" {% endif %}
                    >
                </div>
            {% endfor %}
        </div>

        <h2 class="card-title">Membership tier</h2>
        <div class="flex justify-center">
            <div class="shadow stats flex flex-col w-full md:flex-row mb-10 mx-5">
                <div class="stat flex flex-row md:flex-col justify-between">
                    <div>
                        <div class="stat-title">Starter</div>
                        <div class="stat-value">$5/m</div>
                        <div class="stat-desc">1 invoice</div>
                    </div>
                    <div>
                        <div class="stat-actions">
                            <button class="btn btn-sm btn-accent btn-outline" type="button" id="Starter">Select</button>
                        </div>
                    </div>
                </div>

                <div class="stat flex flex-row md:flex-col content-center justify-between">
                    <div>
                        <div class="stat-title">Professional</div>
                        <div class="stat-value">$19/m</div>
                        <div class="stat-desc">2 invoices</div>
                    </div>
                    <div>
                        <div class="stat-actions">
                            <button class="btn btn-sm btn-accent btn-outline" type="button" id="Professional">Select</button>
                        </div>
                    </div>
                </div>

                <div class="stat flex flex-row md:flex-col justify-center content-center justify-between">
                    <div>
                        <div class="stat-title">Business</div>
                        <div class="stat-value">$49/m</div>
                        <div class="stat-desc">unlimited invoices</div>
                    </div>
                    <div>
                        <div class="stat-actions">
                            <button class="btn btn-sm btn-accent btn-outline" type="button" id="Business">Select</button>
                        </div>
                    </div>
                </div>

                <div class="stat flex flex-row md:flex-col justify-center content-center justify-between">
                    <div>
                        <div class="stat-title">Fee</div>
                        <div class="stat-value">1% fee</div>
                        <div class="stat-desc">same features as Business</div>
                    </div>
                    <div>
                        <div class="stat-actions">
                            <button class="btn btn-sm btn-accent btn-outline" type="button" id="Invoice_Fee">Select</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="card-actions flex justify-center mb-10">
        <a class="btn btn-ghost" hx-get="{% url 'timary:settings_partial' %}" hx-target="closest form" hx-swap="outerHTML" hx-indicator="#settings_spinnr"> Cancel </a>
        <button class="btn btn-primary" type="submit" hx-indicator="#settings_spinnr"> Update settings </button>
        {% include "partials/_spinnr.html" with spinner_id="settings_spinnr"%}
    </div>

</form>
<script nonce="update-subscription" defer>
    var current_plan = document.getElementById("{{ current_plan }}");
    current_plan.classList.add('plan-chosen');
    current_plan.classList.remove('btn-outline');
    current_plan.innerText = "Chosen";

    var starter_plan = document.getElementById("Starter");
    var professional_plan = document.getElementById("Professional");
    var business_plan = document.getElementById("Business");
    var invoice_fee_plan = document.getElementById("Invoice_Fee")

    starter_plan.addEventListener("click", selectSubscriptionPlan);
    professional_plan.addEventListener("click", selectSubscriptionPlan);
    business_plan.addEventListener("click", selectSubscriptionPlan);
    invoice_fee_plan.addEventListener("click", selectSubscriptionPlan);

    function selectSubscriptionPlan(e) {
        e.preventDefault();
        var old_plan = document.querySelector(".plan-chosen");
        old_plan.classList.remove('plan-chosen');
        old_plan.classList.add('btn-outline');
        old_plan.innerText = "Select";

        var plan = document.getElementById(e.target.id);
        plan.classList.add('plan-chosen');
        plan.classList.remove('btn-outline');
        plan.innerText = "Chosen";
    }

    function get_membership_tier(e) {
        return document.querySelector(".plan-chosen").id.toUpperCase();
    }

</script>
