<div class="flex flex-col md:flex-row w-full"
    hx-get="{% url 'timary:invoice_hour_stats' invoice_id=invoice.id %}"
    hx-trigger="refreshHourStats-{{ invoice.email_id }} from:body"
    hx-swap="outerHTML">
    {% if invoice.get_hours_tracked.count > 0 %}
        <div class="flex flex-grow flex-col items-center w-full">
            <p class="text-center mb-12">Hours logged this period</p>
            <div class="h-full w-3/4">
                <ul class="list-none">
                    {% for hour in invoice.get_hours_tracked %}
                        <li class="text-xl flex justify-between"><span>{{ hour.date_tracked|date:"M j" }}</span><span>{{ hour.hours|floatformat:-2 }} hrs</span></li>
                    {% endfor %}
                </ul>
                <div class="flex justify-center">
                    <label
                        for="edit-hours-modal"
                        class="btn btn-outline btn-sm modal-button my-5"
                        hx-get="{% url 'timary:edit_invoice_hours' invoice_id=invoice.id %}"
                        hx-target=".inner-modal"
                        hx-swap="innerHTML"
                        _="on click add .loading to me end
                            on htmx:afterRequest remove .loading from me end"
                    >
                        Edit hours
                    </label>
                </div>
            </div>
        </div>
        <div class="divider md:divider-horizontal"></div>
    {% endif %}
    {{ invoice.budget_percentage }}
    {% if invoice.budget_percentage > 0 %}
        <div class="flex flex-col w-full">
            <div class="text-center mb-5">Budget</div>
            <div class="flex justify-center mb-5 sm:mb-12">
                <div
                    class="radial-progress text-black bg-accent border-4 border-accent"
                    style="--value:{{ invoice.budget_percentage|floatformat:-2 }}; --thickness: 4px;"
                >
                    {{ invoice.budget_percentage|floatformat:2 }}%
                </div>
            </div>
        </div>
        <div class="divider md:divider-horizontal"></div>
    {% endif %}
    <div class="w-full">
        <div class="flex flex-row justify-center w-full h-48">
            <canvas id="chart-{{ invoice.email_id }}"></canvas>
        </div>
    </div>
</div>

<script>
    var config = {
        type: 'bar',
        data: {
            datasets: [
                {
                    "data": {{ invoice.get_last_six_months.1|safe }},
                    "label": '$$ Earned last 6 months',
                    "fill": false,
                    "backgroundColor": ["rgba(255, 99, 132, 0.2)","rgba(255, 159, 64, 0.2)","rgba(255, 205, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(54, 162, 235, 0.2)","rgba(153, 102, 255, 0.2)","rgba(201, 203, 207, 0.2)"],
                    "borderColor": ["rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(54, 162, 235)","rgb(153, 102, 255)","rgb(201, 203, 207)"],
                    "borderWidth": 1
                }
            ],
            labels: {{ invoice.get_last_six_months.0|safe }}
        },
        options: {
            responsive: true,
            legend: {
                labels: {
                    padding: 20,
                    fontSize: 15
                }
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true,
                        autoSkip: false,
                        maxTicksLimit: 20
                    },
                }]
            }
        }
    };
    var ctx = document.getElementById('chart-{{invoice.email_id}}');
    new Chart(ctx, config);
</script>
